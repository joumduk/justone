{"version":3,"sources":["index.ion"],"names":["ion","global","DEBUG","primitive","string","number","boolean","function","isPrimitive",{"type":"Identifier","name":"isPrimitive","loc":{"start":{"line":10,"column":4,"fixed":true,"source":"ion/index.ion"},"end":{"line":10,"column":15,"fixed":true,"source":"ion/index.ion"}}},"object","normalizeProperty","property","name","writable","value","Array","isArray","get","set","hasOwnProperty","normalizeProperties","properties","variableArgConstructs","type","a","nodeObserveShim","Object","observe","checkForChanges","createShim","isObjectObservable","Node","NodeList","patch","mergePatch","merge","key","create","args","length","setImmediate","document","hiddenDiv","createElement","callbacks","MutationObserver","records","cbList","callback","attributes","setAttribute","push","fn","setTimeout","template","createRuntime","ast","parent","Context","context","setVariableLiteral","nextTick","process","clone","deep","item","constructor","observer","console","tryWrapper","changes","error","addEventListener","onObserved","unobserve","removeEventListener","unObserved","bind","thisArg","newFn","id","add","container","remove","capture","captureSuffix","endsWith","substring","originalItem","apply","arguments","nodeType","JSON","stringify","createTextNode","appendChild","parentNode","removeChild","lastIndexOf","removeAt","index","splice","onAdded","onRemoved","defineProperties","defineClass","definitions","classDefinition","super","match","Error","classFunction","eval","canSetClassProperty","descriptor","getOwnPropertyDescriptor","types","Set","i","definition","prototype","is","instance","makeReactive","activate","observeCount","deactivate","call","serialize","deserialize","extractType","typeKey","typeName","serializable","parse","typedObject","test","Foo","getValue","result","f","b","s","defineProperty","exports","enumerable","require","window"],"mappings":"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","sourcesContent":["const ion = null # shouldn't depend on itself\n\nimport './es6'\n\n# with this set to false we will miss any errors in Object.observe callbacks.\nglobal.DEBUG ?= true\n\nconst\n    primitive = {string:true,number:true,boolean:true,function:true}\n    isPrimitive = (object) -> not object? or primitive[typeof object] or false\n    normalizeProperty = (property, name) ->\n        if typeof property is 'function'\n            property =\n                writable: false\n                value: property\n        else if isPrimitive(property) or Array.isArray(property)\n            property =\n                value: property\n\n        if not property.get? and not property.set? and not property.hasOwnProperty('value')\n            property.value = undefined\n\n        if property.hasOwnProperty('value')\n            property.writable ?= true\n\n        property.name = name\n\n        return property\n    normalizeProperties = (properties = {}) ->\n        for name, property of properties\n            properties[name] = normalizeProperty(property, name)\n        return properties\n    variableArgConstructs = []\n        (type, a) -> new type()\n        (type, a) -> new type(a[0])\n        (type, a) -> new type(a[0], a[1])\n        (type, a) -> new type(a[0], a[1], a[2])\n        (type, a) -> new type(a[0], a[1], a[2], a[3])\n        (type, a) -> new type(a[0], a[1], a[2], a[3], a[4])\n        (type, a) -> new type(a[0], a[1], a[2], a[3], a[4], a[5])\n        (type, a) -> new type(a[0], a[1], a[2], a[3], a[4], a[5], a[6])\n        (type, a) -> new type(a[0], a[1], a[2], a[3], a[4], a[5], a[6], a[7])\n        (type, a) -> new type(a[0], a[1], a[2], a[3], a[4], a[5], a[6], a[7], a[8])\n        (type, a) -> new type(a[0], a[1], a[2], a[3], a[4], a[5], a[6], a[7], a[8], a[9])\n    nodeObserveShim = Object.observe?.checkForChanges ? Object : import('./es6/Object.observe').createShim()\n    isObjectObservable = do ->\n        let Node = global.Node ? ->\n        let NodeList = global.NodeList ? ->\n        return (a) ->\n            if a instanceof Node or a instanceof NodeList\n                return false\n            return true\n\nexport const\n    patch = do ->\n        let mergePatch = import './mergePatch'\n        let patch = (object, patch) -> mergePatch.merge(object, patch)\n        for key, value of mergePatch\n            patch[key] = value\n        return patch\n    create = (type, args) -> variableArgConstructs[args.length](type, args)\n    setImmediate = do ->\n        if global.setImmediate?\n            return global.setImmediate\n        if global.document?\n            return do ->\n                let hiddenDiv = document.createElement(\"div\")\n                let callbacks = []\n                new MutationObserver(\n                    (records) ->\n                        let cbList = callbacks\n                        callbacks = []\n                        for callback in cbList\n                            callback()\n                )\n                .observe(hiddenDiv, { attributes: true })\n            return setImmediate(callback) ->\n                if (callbacks.length is 0)\n                    hiddenDiv.setAttribute('yes', 'no')\n                callbacks.push(callback)\n        return (fn) ->\n            setTimeout(fn, 0)\n    template = (fn, template) ->\n        fn.template = template ? true\n        return fn\n    createRuntime = (ast, args, parent) ->\n        const Context = import './runtime/Context'\n        const context = new Context(parent)\n        if args?\n            for name, value of args\n                context.setVariableLiteral(name, value)\n        return context.createRuntime(ast)\n    nextTick = @process?.nextTick ? (fn) -> setTimeout(fn, 0)\n    clone = (object, deep = false) ->\n        if Array.isArray(object)\n            return [deep ? clone(item, deep) : item for item in object]\n        else if object?.constructor is Object\n            return {}\n                for key, value of object\n                    [key]: deep ? clone(value, deep) : value\n        else\n            return object\n    observe = (object, observer, property) ->\n        if object is global or object is console\n            return\n        # property is optional\n        if not isObjectObservable(object)\n            if not property?\n                return\n            nodeObserveShim.observe(object, observer, property)\n        else if object? and observer? and Object.observe? and typeof object is 'object'\n            if DEBUG\n                observer.tryWrapper ?= (changes) ->\n                    try\n                        observer(changes)\n                    catch error\n                        console.error('Exception in Object.observe callback', error)\n            Object.observe(object, observer.tryWrapper ? observer)\n            # watch change on dom elements\n            object.addEventListener?('change', observer)\n        object?.onObserved?(observer, property)\n    unobserve = (object, observer, property) ->\n        # property is optional\n        if not isObjectObservable(object)\n            if not property?\n                return\n            nodeObserveShim.unobserve(object, observer, property)\n        else if object? and observer? and Object.unobserve? and typeof object is 'object'\n            Object.unobserve(object, observer.tryWrapper ? observer)\n            # unwatch change on dom elements\n            object.removeEventListener?('change', observer)\n        object?.unObserved?(observer, property)\n    checkForChanges = ->\n        if Object.observe.checkForChanges?\n            Object.observe.checkForChanges()\n        else\n            nodeObserveShim.observe.checkForChanges()\n    bind = (fn, thisArg) ->\n        let newFn = fn.bind(thisArg)\n        # the function name has semantic meaning for us when adding a function to an element\n        # (see add function below)\n        # so we copy the function name to the new bound function id property when binding\n        # (function.name is readonly)\n        if fn.name?.length > 0\n            newFn.id = fn.id ? fn.name\n        return newFn\n    add = (container, item) ->\n        let remove\n        if typeof item is 'function' and (item.name?.length > 0 or item.id?) and typeof container.addEventListener is 'function'\n            let name = item.id ? item.name\n            let capture = false\n            let captureSuffix = '_capture'\n            if name.endsWith(captureSuffix)\n                capture = true\n                name = name.substring(0, name.length - captureSuffix.length)\n            # we wrap all event handlers and call checkForChanges after\n            let originalItem = item\n            item = ->\n                originalItem.apply(@, arguments)\n                checkForChanges()\n            container.addEventListener(name, item, capture)\n            remove = ->\n                container.removeEventListener(name, item)\n        else if container.nodeType is 1\n            if typeof item isnt 'string' and not item?.nodeType?\n                item = JSON.stringify(item)\n            if typeof item is 'string'\n                item = document.createTextNode(item)\n            container.appendChild(item)\n            remove = ->\n                if item.parentNode is container\n                    container.removeChild(item)\n        else\n            if container.push?\n                container.push(item)\n            else\n                container.add(item)\n            remove = ->\n                if container.lastIndexOf? and container.removeAt?\n                    let index = container.lastIndexOf(item)\n                    if index >= 0\n                        container.removeAt(index)\n                else if typeof container.remove is 'function'\n                    container.remove(item)\n                else if Array.isArray(container)\n                    let index = container.lastIndexOf(item)\n                    if index >= 0\n                        container.splice(index, 1)\n\n        item?.onAdded?(container)\n        # returns a function which can be used to remove the item\n        return ->\n            remove()\n            item?.onRemoved?(container)\n    defineProperties = (object, properties) -> Object.defineProperties(object, normalizeProperties(properties))\n    defineClass = (...definitions) ->\n        const classDefinition = definitions[0]\n        if definitions[1] is undefined\n            # extend our base object by default unless user sets extends to null explicitly.\n            definitions[1] = import './Object'\n        classDefinition.super = definitions[1]\n        const name = classDefinition.name ? classDefinition.id?.match(/([a-z_0-9\\$]+)(\\.js)?$/i)?[1]\n        if not name?\n            throw new Error('missing name property')\n        let classFunction\n        if classDefinition.hasOwnProperty('constructor')\n            classFunction = classDefinition.constructor\n        else if classDefinition.super?\n            classFunction = eval(\"(function {{name}}() { {{name}}.super.apply(this, arguments); })\")\n        else\n            classFunction = eval(\"(function {{name}}() {})\")\n\n        # successively merge patch the definitions onto the new class\n        let canSetClassProperty = (key) ->\n            if key is 'name'\n                return false\n            let descriptor = Object.getOwnPropertyDescriptor(classFunction, key)\n            return not descriptor? or descriptor.writable or not descriptor.get?\n\n        let types = new Set()   # a map of all types\n        types.add(classFunction)\n        for let i = definitions.length - 1; i >= 0; i--\n            let definition = definitions[i]\n            if definition?\n                types.add(definition)\n                for key, value of definition if key isnt 'test' or i is 0\n                    if canSetClassProperty(key)\n                        classFunction[key] = patch(classFunction[key], value)\n                        \n        classFunction.types = types\n\n        if classFunction.properties?\n            defineProperties(classFunction.prototype, classFunction.properties)\n\n        return classFunction\n    is = (instance, type) ->\n        if not instance?\n            return false\n        if not type?\n            return true\n        if typeof type is 'function'\n            if typeof instance.is is 'function'\n                return instance.is(type)\n            return instance instanceof type\n        else\n            return instance is type\n    makeReactive = (object, activate) ->\n        let observeCount = 0\n        let deactivate = null\n        return Object.defineProperties(\n            object\n            {}\n                onObserved:\n                    value: ->\n                        observeCount++\n                        if observeCount is 1\n                            deactivate = activate.call(object)\n                unObserved:\n                    value: ->\n                        observeCount--\n                        if observeCount is 0\n                            deactivate?()\n        )\n    serialize = (object) -> JSON.stringify(object)\n    deserialize = do ->\n        let extractType = (object) ->\n            let typeKey = import('ion/Object').typeKey\n            # we should strongly type our objects when created, so make a factory\n            let typeName = object[typeKey]\n            if not typeName?\n                return Object\n            let type = import(typeName)\n            if not type.serializable\n                throw new Error(\"Type is not serializable: {{ typeName }}\")\n            # remove the type field from the source object\n            delete object[typeKey]\n            return type\n        let deserialize = (object) ->\n            if typeof object is 'string'\n                object = JSON.parse(object)\n            let typeKey = import('ion/Object').typeKey\n            # we should strongly type our objects when created, so make a factory\n            let typeName = object[typeKey]\n            if typeName?\n                let type = import(typeName)\n                if not type.serializable\n                    throw new Error(\"Type is not serializable: {{ typeName }}\")\n                let typedObject = new type\n                for key, value of object if key isnt typeKey\n                    typedObject[key] = object[key]\n                return typedObject\n            else\n                return object\n        deserialize.extractType = extractType\n        return deserialize\n    test =\n        defineClass: ->\n            const Foo = defineClass(\n                {}\n                    id: \"Foo\"\n                    constructor: (number) ->\n                        @number = number\n                    properties:\n                        getValue: -> @number\n            )\n            assert new Foo(2).getValue() is 2\n        defineProperties:\n            \"should allow primitive values\": ->\n                const object = {}\n                const result = defineProperties(\n                    object\n                    {}\n                        f: -> \"function\"\n                        i: 2\n                        b: true\n                        a: []\n                        s: \"hello\"\n                )\n                assert object is result\n                assert typeof object.f is 'function'\n                assert object.f() is 'function'\n                assert object.i is 2\n                assert object.b is true\n                assert Array.isArray(object.a)\n                assert object.s is 'hello'\n\nfor name in [\"runtime\", \"compiler\", \"builder\", \"browser\"]\n    do (name) ->\n        Object.defineProperty(exports, name, {enumerable: true, get: -> require(\"./\" + name)})\n\n# if window, then on resize, check for changes\nif global.window?\n    global.window.addEventListener('resize', checkForChanges)\n"]}