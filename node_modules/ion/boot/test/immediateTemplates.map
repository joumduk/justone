{"version":3,"sources":["immediateTemplates.ion"],"names":["ion","templates","a","b","Date","x","y","z","position","c","d","e","patch","test",{"type":"Identifier","name":"test","loc":{"start":{"line":151,"column":4,"fixed":true,"source":"ion/test/immediateTemplates.ion"},"end":{"line":151,"column":8,"fixed":true,"source":"ion/test/immediateTemplates.ion"}}},"index","templateType","args","expected","template","apply","reactiveResult","beforeCount","observe","count","unobserve","value","watchCount","JSON","stringify","console","log","afterCount","Error"],"mappings":"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","sourcesContent":["const ion = import '../'\n\nconst templates = []\n    []\n        template ->\n            const\n                a = 1\n                b = 2\n                c = a + b\n            return c\n        []\n        3\n    []\n        template (rows) ->\n            return []\n                for item in rows\n                    if item?\n                        item.toString()\n                    else\n                        \"<null>\"\n                else\n                    # this else verifies that we don't have a for-else memory leak when activating the else statement\n                    void rows.length\n        []\n            []\n                1\n                null\n                2\n                3\n                null\n                4\n        [\"1\",\"<null>\",\"2\",\"3\",\"<null>\",\"4\"]\n    []\n        template -> {a:1,b:2}\n        []\n        {a:1,b:2}\n    []\n        template ->\n            return []\n                1\n                2\n        []\n        [1,2]\n    []\n        template ->\n            let a = 1\n            let b = 2\n            return []\n                a\n                b\n                if a > b\n                    10\n                else if b > a\n                    20\n        []\n        [1,2,20]\n    []\n        template ->\n            let items = [1,2,3]\n            let x = [item + index for item, index in items]\n            return x\n        []\n        [1,3,5]\n    []\n        template ->\n            let items = {a:1,b:2,c:3}\n            let x = [key + value for key, value of items]\n            return x\n        []\n        ['a1', 'b2', 'c3']\n    []\n        template ->\n            let object = {a:{b:1}}\n            return object?.a?.b\n        []\n        1\n    []\n        template -> false ? 1 : 2\n        []\n        2\n    []\n        template -> null ? 2\n        []\n        2\n    []\n        template ->\n            let a = null\n            let b = 2\n            return [a?, b?]\n        []\n        [false,true]\n    []\n        template -> Math.min(1, 2)\n        []\n        1\n    []\n        template -> Math.min.call(null, 1, 2)\n        []\n        1\n    []\n        template -> new Date(2011, 10, 5)\n        []\n        new Date(2011, 10, 5)\n    []\n        template -> /foo/\n        []\n        /foo/\n    []\n        template ->\n            return\n                x: 1\n                y: 2\n                z: []\n                    let items = [3,2,1]\n                    for item in items\n                        item * 2\n        []\n        {x:1, y:2, z:[6,4,2]}\n    []\n        template -> [null ? 1, undefined ? 2]\n        []\n        [1, 2]\n    []\n        template ({a,b}) -> a + b\n        [{a:1,b:2}]\n        3\n    []\n        template (type) ->\n            return new type\n                position:\n                    x: 10\n        []\n            ->\n                @position = {x:1,y:2}\n        {position:{x:10,y:2}}\n    []\n        template (input, output) ->\n            output:\n                e: input.a + input.b\n            return output\n        []\n            {a:1,b:2}\n            {c:3,d:4}\n        {c:3,d:4,e:3}\n    []\n        template -> ion.patch\n        []\n        ion.patch\n\nexport const\n    test = ->\n        for [templateType, args, expected], index in templates if expected?\n            let template = templateType.apply(this, args)\n            let reactiveResult = null\n            let beforeCount = ion.observe.count ? 0\n            let unobserve = template.observe((value) -> reactiveResult = value)\n            let watchCount = ion.observe.count ? 0\n            try\n                assert reactiveResult is expected or JSON.stringify(reactiveResult) is JSON.stringify(expected)\n            catch e\n                console.log(reactiveResult, \"!==\", expected)\n                throw e\n\n            unobserve()\n            let afterCount = ion.observe.count ? 0\n            if afterCount isnt beforeCount\n                throw new Error(\"Template observe leak in template {{index}}.  Before: {{beforeCount}}, After: {{afterCount}}\")\n            # console.log({beforeCount,watchCount,afterCount})\n            # assert reactiveResult is undefined\n            # # also, call the template function imperatively and see that it's still the expected value\n            # let imperativeResult = templateType.apply(null, args)\n            # # console.log('imperativeResult: ', imperativeResult)\n            # assert JSON.stringify(imperativeResult) is JSON.stringify(expected)\n\n"]}