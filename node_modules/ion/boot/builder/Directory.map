{"version":3,"sources":["Directory.ion"],"names":["global","Window","ion","fs","np","utility","watcher","File","Directory","constructor","path","String","properties","exists","get",{"type":"Identifier","name":"get","loc":{"start":{"line":20,"column":12,"fixed":true,"source":"ion/builder/Directory.ion"},"end":{"line":20,"column":15,"fixed":true,"source":"ion/builder/Directory.ion"}}},"existsSync","toString","hasOwnProperty","getAbsoluteName","read","set","content","console","log","write","encoding","delete","getFile","getDirectory","getRelativeName","relative","join","search","include","exclude","options","initial","results","makeReactive","unwatch","watchDirectory","filename","file","modified","getModified","checkForChanges","files","list"],"mappings":"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","sourcesContent":["\nif global.Window\n    return\n\nconst\n    ion = import '../'\n    fs = import 'fs'\n    np = import 'path'\n    utility = import './utility'\n    watcher = import './watcher'\n    File = import './File'\n\nexport class Directory\n    constructor: (path) ->\n        if path?\n            @path = String(path)\n    properties:\n        exists:\n            # exists is not reactive\n            get: -> fs.existsSync(@path)\n        path: '.'\n        toString: -> @path\n        get: (path) ->\n            # allow us to get our own properties\n            if @hasOwnProperty(path) or @[path]?\n                return @[path]\n\n            path = @getAbsoluteName(path)\n            if fs.existsSync(path)\n                return utility.read(path)\n            else\n                return undefined\n        set: (path, content) ->\n            if @hasOwnProperty(path) or @[path]?\n                return @[path] = content\n\n            path = @getAbsoluteName(path)\n            if content?\n                console.log(\"Writing: \" + path)\n            else\n                console.log(\"Deleting: \" + path)\n            utility.write(path, content)\n            return content\n        read: (path) ->\n            # allow us to get our own properties\n            if @hasOwnProperty(path) or @[path]?\n                return @[path]\n\n            path = @getAbsoluteName(path)\n            if fs.existsSync(path)\n                return utility.read(path)\n            else\n                return undefined\n        write: (path, content, encoding) ->\n            if not content?\n                return\n            if @hasOwnProperty(path) or @[path]?\n                return @[path] = content\n\n            path = @getAbsoluteName(path)\n            console.log(\"Writing: \" + path)\n            utility.write(path, content, encoding)\n        delete: (path) ->\n            console.log(\"Deleting: \" + path)\n            path = @getAbsoluteName(path)\n            utility.write(path, null)\n        getFile: (path) -> new File(@getAbsoluteName(path))\n        getDirectory: (path) -> new Directory(@getAbsoluteName(path))\n        getRelativeName: (path) -> np.relative(@path, String(path))\n        getAbsoluteName: (path) -> np.join(@path, String(path))\n        search: (include, exclude, options) ->\n            options ?=\n                initial: false\n            if include?\n                options.include = include\n            if exclude?\n                options.exclude = exclude\n            let results = {}\n            ion.makeReactive(\n                results\n                =>\n                    let unwatch = watcher.watchDirectory(\n                        @path\n                        options\n                        (filename) =>\n                            let path = @getRelativeName(filename)\n                            if fs.existsSync(filename)\n                                if not results[path]?\n                                    results[path] = new File(filename)\n                                else\n                                    let file = results[path]\n                                    let modified = utility.getModified(filename)\n                                    if modified isnt file.modified\n                                        file.modified = modified\n                                    else\n                                        return\n                            else\n                                delete results[path]\n                            # explicit check is only because current\n                            # nodejs versions don't have Object.observe yet.\n                            ion.checkForChanges()\n                    )\n                    return unwatch\n            )\n            let files = utility.list(@path, options)\n            for path in files\n                results[@getRelativeName(path)] = new File(path)\n            return results\n\n\n\n"]}